{% extends "app/layout.html" %}

{% block menu_top %}
  {% include "app/menu_top.html" with discover_act="active" %}
{% endblock menu_top %}


{% block content %}
{% load static %}
<link rel="stylesheet" type="text/css" href="{% static 'quantlab/bcard.css' %}">


<div class="ui text container" style="text-align:center;margin-top:20px">

  <div style="background:none;margin-top:10px;margin-bottom:10px;text-align:right;">
    <div class="mypostonly ui toggle checkbox" style="float:left;background:none;margin-top:5px;">
      <input type="checkbox" id="mypostonly">
      <label for="mypostonly">My posts only</label>
    </div>

    <div class="ui icon tiny basic buttons">
      <button class="ui button" onclick="resize_cards(1)"><i class="minus icon"></i></button>
      <button class="ui button" onclick="resize_cards(-1)"><i class="plus icon"></i></button>
    </div>
    <a class="ui icon tiny basic button" href="{% url 'posting' %}">
      <i class="pencil alternate icon"></i>
    </a>

    <div style="clear:both;"></div>
  </div>

  <div class="bcards ui cards" style="background:none;"></div>
</div>
{% endblock content %}


{% block js %}
  {{ block.super }}

  <script src="{% static 'quantlab/bcard.js' %}"></script>
  <script>
    var ncols = 4;
    var ncols_max = 6;
    var ncols_min = 1;
    var ncols_matcher = {1:'one', 2:'two', 3:'three', 4:'four', 5:'five', 6:'six'};

    function load_posts(type) {
      var url = "{% url 'posts_sub' %}?type=" + type;
      $('.bcards').attr('class', "bcards ui cards " + ncols_matcher[ncols]);
      $('.bcards').html('').load(url, function() {
        $(window).trigger('resize');
      });
    };

    function resize_cards(step) {
      if (step > 0) {
        ncols = Math.min(ncols+step, ncols_max);

      } else if (step < 0) {
        ncols = Math.max(ncols+step, ncols_min);
      }

      $('.bcards').attr('class', "bcards ui cards " + ncols_matcher[ncols]);
      $(window).trigger('resize');
    }

    $(document).ready(function(){
      if ($(window).width() < 500) {
        ncols = 3;
      }
      load_posts('{{ type }}');
    })

    $('.mypostonly.checkbox').checkbox({
      onChecked: function() {
        load_posts('my');
      },
      onUnchecked: function() {
        load_posts('all');
      }
    });
  </script>
{% endblock js %}
