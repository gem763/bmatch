<style>
  @keyframes heartbeat
  {
    0%   { transform: scale( 1.3 ); }
    100% { transform: scale( 1 );   }
    /* 40%  { transform: scale( .75 ); }
    60%  { transform: scale( 1 );   }
    80%  { transform: scale( .75 ); }
    100% { transform: scale( .75 ); } */
  }
</style>

{% load el_pagination_tags %}

{% if brands.all %}
  {% lazy_paginate 40,10 brands.all as all %}
  {% for brand in all %}
    {% include "app/brand_card.html" with brand=brand %}
  {% endfor %}
  {% show_more %}
{% endif %}

{% if brands.recommend %}
  {% lazy_paginate brands.recommend as recommend %}
  {% for brand in recommend %}
    {% include "app/brand_card.html" with brand=brand %}
  {% endfor %}
  {% show_more %}
{% endif %}

{% if brands.not_recommend %}
  <div class="ui horizontal divider header">Not Recommend</div>
  {% lazy_paginate brands.not_recommend as not_recommend %}
  {% for brand in not_recommend %}
    {% include "app/brand_card.html" with brand=brand %}
  {% endfor %}
  {% show_more %}
{% endif %}

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="/static/semantic/semantic.min.js"></script>

<script>
  $(window).resize(function(){
    var width = $(".brand.card").width();
    $(".brand.card").css("height", width+"px");
    $(".brand.card img").css({"width":width+"px", "height":width+"px"});
    $(".brand.card .like.icon").css("font-size", width*0.15);
  });

  $(window).trigger('resize');

  function bcard_mouseover(bcard) {
    $(bcard).css({
      "box-shadow": "0 0 10px 5px gainsboro"
    });
    $(bcard).find(".grad").css("opacity", 1);
  };

  function bcard_mouseout(bcard) {
    $(bcard).css("box-shadow", "0 0 10px 1px gainsboro");
    $(bcard).find(".grad").css("opacity", 0);
  };

  function bcard_click(bcard) {
    var url = $(bcard).attr("href");
    window.location.assign(url); //.replace()로 하면 history가 저장 안된다
    // window.location.replace(url);
  };

  function like_mouseover(obj) {
    var icon = $(obj).children(".like.icon")
    icon.css({
      // "opacity": 1,
      "animation": "heartbeat 0.7s infinite"
    });
  };

  function like_mouseout(obj) {
    var icon = $(obj).children(".like.icon")
    var state = icon.attr("state");
    var opacity;

    if (state=="like") {
      opacity = 1;
    } else {
      opacity = 0.5;
    };

    icon.css({
      "opacity": opacity,
      "animation": ""
    });
  };

  function toggle_like(event, obj) {
    event.stopPropagation();
    var icon = $(obj).children(".like.icon");
    var state = icon.attr("state");
    var bname = $(obj).parents(".brand.card").attr("bname")
    var data;

    if (state=="like") {
      icon.attr("state", "dontlike");
      icon.attr("class", "like outline heart icon");
      icon.css({"opacity":0.5, "color":"gainsboro"});
      data = {dontlike:bname};

    } else {
      icon.attr("state", "like");
      icon.attr("class", "like yellow heart icon");
      icon.css({
        "opacity": 1,
        "color": "",
        "animation": "heartbeat 1s"
      });
      data = {like:bname};
      // icon.transition('scale');
    };

    $.ajax({
      url: {% url 'save_like' %},
      async: true,
      type: 'GET',
      data: data,
      dataType: 'json',
      success: function(jqXHR) {
        if (!jqXHR.success) {
          alert("데이터를 처리하는데 문제가 발생하였습니다.");
        };
      }
    });
  };
</script>
