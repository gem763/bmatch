{% extends "app/layout.html" %}

{% load static %}
{% block style %}
  {{ block.super }}
  <link rel="stylesheet" href="https://unpkg.com/tippy.js@4/themes/light.css"/>
  <link rel="stylesheet" href="{% static 'quantlab/bcard.css' %}">

  <style>
    .axis {
    	font: 15px sans-serif;
    }

    .axis path,
    .axis line {
      fill: none;
      stroke: #D4D8DA;
      stroke-width: 2px;
      shape-rendering: crispEdges;
    }

    #chart {
    	position: absolute;
    	top: 50px;
    	left: 100px;
    }

    .toolTip {
      pointer-events: none;
    	position: absolute;
        display: none;
      min-width: 50px;
      height: auto;
      background: none repeat scroll 0 0 #ffffff;
      padding: 9px 14px 6px 14px;
      border-radius: 2px;
      text-align: center;
      line-height: 1.3;
      color: #5B6770;
      box-shadow: 0px 3px 9px rgba(0, 0, 0, .15);
    }

    .toolTip:after {
      content: "";
      width: 0;
      height: 0;
      border-left: 12px solid transparent;
      border-right: 12px solid transparent;
      border-top: 12px solid white;
      position: absolute;
      bottom: -10px;
      left: 50%;
      margin-left: -12px;
    }

    .toolTip span {
    	font-weight: 500;
      color: #081F2C;
    }
  </style>
{% endblock style %}

{% block menu_top %}
  {% include "app/menu_top.html" with discover_act="active" %}
{% endblock menu_top %}

{% block content %}
  {% include "app/brand_detail_content.html" %}
{% endblock content %}


{% block js %}
  {{ block.super }}
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script src="{% static 'js/d3.layout.cloud.js' %}"></script>
  <script src="{% static 'js/wordcloud.js' %}"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/seedrandom/2.4.3/lib/alea.min.js"></script>

  <script src="https://unpkg.com/popper.js@1/dist/umd/popper.min.js"></script>
  <script src="https://unpkg.com/tippy.js@4"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.bundle.min.js"></script>
  <!-- chartjs 바차트의 rounded bar를 만들어주는 플러그인
  https://github.com/jedtrow/Chart.js-Rounded-Bar-Charts -->
  <script src="{% static 'js/Chart.roundedBarCharts.min.js' %}"></script>
  <script src="{% static 'quantlab/bcard.js' %}"></script>
  <script src="{% static 'js/RadarChart.js' %}"></script>

  <script>
    function append_table_row(id, query_data){
      var btn = document.createElement('button');
      btn.className = "ui green mini compact right aligned button";
      btn.style.width = (query_data.value*0.9).toString()+"%";
      btn.style.borderRadius = "0 20px 20px 0";
      btn.append(query_data.value);

      var td_query = document.createElement('td');
      td_query.className = "right aligned eight wide";
      // td_query.addClass("right aligned eight wide");
      // td_query.classList.add("right aligned eight wide");
      td_query.append(query_data.key);

      var td_value = document.createElement('td');
      td_value.className = "eight wide";
      td_value.style.padding = "0px";
      td_value.append(btn);

      var tr = document.createElement('tr');
      tr.append(td_query, td_value);
      // return tr;
      $(id).append(tr);
    };


    $(document).ready(function(){
      $.get('{% url "gtrend" brand.name %}', function(data){
        var ctx1 = $("#trend").get(0).getContext("2d");
        new Chart(ctx1, data.trend_data);

        data.query_top_data.forEach(function(query_data){
          append_table_row('#query_top', query_data);
        });

        data.query_rising_data.forEach(function(query_data){
          append_table_row('#query_rising', query_data);
        });
      });

      WordCloud({
        container: "#wordcloud",
        data: {{ simwords | safe }},
        width: $("#wordcloud").width(),
        height: 600
      });

    });

    // $('.brand.card .image').dimmer({
    //   on: 'hover'
    // });
    //
    // $(window).resize(function(){
    //   var width = $(".brand.card").width();
    //   $(".brand.card").css("height", width+"px");
    //   $(".brand.card img").css({"width":width+"px", "height":width+"px"});
    //   $(".brand.card .like.icon").css("font-size", width*0.15);
    // });
    //
    // $(window).trigger('resize');

  </script>
{% endblock js %}
